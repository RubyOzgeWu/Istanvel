import{A as y,r as D,l as f,m as w,p as m,f as o,Q as u,C as s,b6 as F,D as z,aQ as H,aS as E,aX as G,aT as i,bp as J,bs as K,J as v,G as M,q as O,t as P,F as X,aZ as Y,B as x,K as g,aY as Z,E as j}from"./index.ba8e8a10.js";import{Q as R,a as W}from"./QToolbar.14de37ee.js";import{Q as h}from"./QFile.26272de4.js";import{b as k,Q as U}from"./QSelect.665ed341.js";import{Q as ee}from"./QForm.82a065a9.js";import{Q as q}from"./QAvatar.12db997d.js";import{Q as I,a as T}from"./QItem.5fa24591.js";import{Q as le}from"./QList.a026841d.js";import{Q as S}from"./QTd.0a02bbf3.js";import{Q as te}from"./QTable.4153bee3.js";import{C as L}from"./ClosePopup.04c8406c.js";import{b as V,S as c}from"./user.63492ea5.js";import"./QMenu.90b0984d.js";import"./selection.9debefde.js";import"./rtl.4b414a6d.js";import"./QMarkupTable.f907ef64.js";import"./use-fullscreen.3197ee31.js";const oe={class:"q-pa-md",id:"ToursView"},ae={class:"row"},se={class:"col-12"},ne=m("span",{class:"text-weight-bold"},"\u65B0\u589E\u5546\u54C1",-1),ie={class:"col-12"},re=["src"],de=g("\u7DE8\u8F2F"),ue=g("\u522A\u9664"),me=g("\u7DE8\u8F2F"),pe=g("\u522A\u9664"),ce=["src"],Le={__name:"ToursView",setup(fe){const $=[{name:"Name",required:!0,label:"\u884C\u7A0B\u540D\u7A31\uFF08\u82F1\u6587\uFF09",align:"left",field:a=>a.name,format:a=>`${a}`,sortable:!0},{name:"ChName",align:"center",label:"\u884C\u7A0B\u540D\u7A31\uFF08\u4E2D\u6587\uFF09",field:a=>a.CH_name,sortable:!0},{name:"image",align:"center",label:"\u7167\u7247",sortable:!0},{name:"Category",label:"\u884C\u7A0B\u5206\u985E\uFF08\u82F1\u6587\uFF09",field:a=>a.category,sortable:!0},{name:"edit",label:"\u7DE8\u8F2F",sortable:!0}],n=y([]),_=D(""),e=y({_id:"",name:"",CH_name:"",description:"",CH_description:"",departureLocation:"",departureTime:"",included:"",CH_included:"",notIncluded:"",CH_notIncluded:"",note:"",CH_note:"",image:null,price:0,category:"",CH_category:"",sell:!1,idx:-1,dialog:!1,valid:!1,submitting:!1}),A=["History & Culture","Nature","sacred religion","shopping & experience","cruisine"],N=["\u6B77\u53F2\u6587\u5316","\u81EA\u7136","\u5B97\u6559","\u8CFC\u7269","\u7F8E\u98DF"],r=y({required(a){return!!a||"\u5FC5\u586B"},price(a){return a>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(a){var l,p,t;return!a||!a.length||((p=(l=a[0])==null?void 0:l.type)==null?void 0:p.includes("image"))&&((t=a[0])==null?void 0:t.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),b=a=>{e._id=a;const l=a===""?-1:n.findIndex(p=>p._id===a);l>-1?(e.name=n[l].name,e.CH_name=n[l].CH_name,e.description=n[l].description,e.CH_description=n[l].CH_description,e.departureLocation=n[l].departureLocation,e.departureTime=n[l].departureTime,e.included=n[l].included,e.CH_included=n[l].CH_included,e.notIncluded=n[l].notIncluded,e.CH_notIncluded=n[l].CH_notIncluded,e.note=n[l].note,e.CH_note=n[l].CH_note,e.image=n[l].image,e.price=n[l].price,e.category=n[l].category,e.CH_category=n[l].CH_category,e.sell=n[l].sell):(e.name="",e.CH_name="",e.description="",e.CH_description="",e.departureLocation="",e.departureTime="",e.included="",e.CH_included="",e.notIncluded="",e.CH_notIncluded="",e.note="",e.CH_note="",e.price=0,e.category="",e.CH_category="",e.sell=!1,e.description=""),e.image=null,e.idx=l,e.dialog=!0,e.valid=!1,e.submitting=!1},B=async()=>{e.submitting=!0;const a=new FormData;for(const l in e)["_id","idx","dialog","valid","submitting"].includes(l)||a.append(l,e[l]);try{if(e._id.length===0){const{data:l}=await V.post("/tours",a);n.push(l.result),c.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"}),C()}else{const{data:l}=await V.patch("/tours/"+e._id,a);n[e.idx]=l.result,c.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),C()}e.dialog=!1}catch(l){c.fire({icon:"error",title:"\u5931\u6557",text:l.isAxiosError?l.response.data.message:l.message})}e.submitting=!1},C=async()=>{try{const{data:a}=await V.get("/tours/all");n.splice(0,n.length),n.push(...a.result)}catch(a){console.log(a),c.fire({icon:"error",title:"\u5931\u6557",text:a.isAxiosError?a.response.data.message:a.message})}};C();const Q=async a=>{console.log(a);try{await V.delete("/tours/"+a),await c.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"}),C()}catch(l){await c.fire({icon:"success",title:"\u5931\u6557",text:l.isAxiosError&&l.response.data?l.response.data.message:"\u767C\u751F\u932F\u8AA4"})}};return(a,l)=>{const p=z("q-card-action");return f(),w("div",oe,[m("div",ae,[m("div",se,[o(u,{label:"\u65B0\u589E\u884C\u7A0B",color:"secondary",onClick:l[0]||(l[0]=t=>b(""))}),o(F,{modelValue:e.dialog,"onUpdate:modelValue":l[18]||(l[18]=t=>e.dialog=t),persistent:""},{default:s(()=>[o(H,{style:{width:"700px","max-width":"80vw"}},{default:s(()=>[o(R,null,{default:s(()=>[o(W,null,{default:s(()=>[ne]),_:1})]),_:1}),o(ee,{modelValue:e.valid,"onUpdate:modelValue":l[17]||(l[17]=t=>e.valid=t),onSubmit:E(B,["prevent"])},{default:s(()=>[o(H,null,{default:s(()=>[o(G,{class:"q-pt-none"},{default:s(()=>[o(i,{dense:"",modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.name=t),autofocus:"",label:"\u884C\u7A0B\u540D\u7A31(\u82F1\u6587)",rules:[r.required]},null,8,["modelValue","rules"]),o(i,{dense:"",modelValue:e.CH_name,"onUpdate:modelValue":l[2]||(l[2]=t=>e.CH_name=t),autofocus:"",label:"\u884C\u7A0B\u540D\u7A31(\u4E2D\u6587)",rules:[r.required]},null,8,["modelValue","rules"]),o(i,{dense:"",modelValue:e.description,"onUpdate:modelValue":l[3]||(l[3]=t=>e.description=t),autofocus:"",type:"textarea",label:"\u884C\u7A0B\u6558\u8FF0(\u82F1\u6587)",rules:[r.required]},null,8,["modelValue","rules"]),o(i,{dense:"",modelValue:e.CH_description,"onUpdate:modelValue":l[4]||(l[4]=t=>e.CH_description=t),autofocus:"",type:"textarea",label:"\u884C\u7A0B\u6558\u8FF0\uFF08\u4E2D\u6587\uFF09",rules:[r.required]},null,8,["modelValue","rules"]),o(i,{dense:"",modelValue:e.departureLocation,"onUpdate:modelValue":l[5]||(l[5]=t=>e.departureLocation=t),autofocus:"",label:"\u96C6\u5408\u5730\u9EDE"},null,8,["modelValue"]),o(i,{dense:"",modelValue:e.departureTime,"onUpdate:modelValue":l[6]||(l[6]=t=>e.departureTime=t),autofocus:"",label:"\u96C6\u5408\u6642\u9593"},null,8,["modelValue"]),o(i,{dense:"",modelValue:e.included,"onUpdate:modelValue":l[7]||(l[7]=t=>e.included=t),autofocus:"",type:"textarea",label:"\u5305\u542B\uFF08\u82F1\u6587\uFF09"},null,8,["modelValue"]),o(i,{dense:"",modelValue:e.CH_included,"onUpdate:modelValue":l[8]||(l[8]=t=>e.CH_included=t),autofocus:"",type:"textarea",label:"\u5305\u542B\uFF08\u4E2D\u6587\uFF09"},null,8,["modelValue"]),o(i,{dense:"",modelValue:e.note,"onUpdate:modelValue":l[9]||(l[9]=t=>e.note=t),autofocus:"",type:"textarea",label:"\u5099\u8A3B\uFF08\u82F1\u6587\uFF09"},null,8,["modelValue"]),o(i,{dense:"",modelValue:e.CH_note,"onUpdate:modelValue":l[10]||(l[10]=t=>e.CH_note=t),autofocus:"",type:"textarea",label:"\u5099\u8A3B\uFF08\u4E2D\u6587\uFF09"},null,8,["modelValue"]),o(h,{dense:"",modelValue:e.image,"onUpdate:modelValue":l[11]||(l[11]=t=>e.image=t),autofocus:"",label:"\u7167\u7247"},null,8,["modelValue"]),o(i,{dense:"",modelValue:e.price,"onUpdate:modelValue":l[12]||(l[12]=t=>e.price=t),autofocus:"",label:"\u50F9\u683C",rules:[r.required,r.price]},null,8,["modelValue","rules"]),o(k,{modelValue:e.category,"onUpdate:modelValue":l[13]||(l[13]=t=>e.category=t),options:A,label:"\u884C\u7A0B\u5206\u985E\uFF08\u82F1\u6587\uFF09",rules:[r.required]},null,8,["modelValue","rules"]),o(k,{modelValue:e.CH_category,"onUpdate:modelValue":l[14]||(l[14]=t=>e.CH_category=t),options:N,label:"\u884C\u7A0B\u5206\u985E\uFF08\u4E2D\u6587\uFF09",rules:[r.required]},null,8,["modelValue","rules"]),o(J,{modelValue:e.sell,"onUpdate:modelValue":l[15]||(l[15]=t=>e.sell=t),label:"\u4E0A\u67B6",color:"teal"},null,8,["modelValue"])]),_:1}),o(K,{align:"right",class:"text-primary"},{default:s(()=>[v(o(u,{flat:"",type:"submit",loading:e.submitting,label:"\u78BA\u5B9A"},null,8,["loading"]),[[L]]),v(o(u,{flat:"",label:"\u53D6\u6D88",onClick:l[16]||(l[16]=t=>e.dialog=!1),disabled:e.submitting},null,8,["disabled"]),[[L]])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),m("div",ie,[o(te,{grid:a.$q.screen.lt.md,title:"\u884C\u7A0B\u7BA1\u7406",rows:n,columns:$,"row-key":"name",filter:_.value},{"top-right":s(()=>[o(i,{borderless:"",dense:"",debounce:"300",modelValue:_.value,"onUpdate:modelValue":l[19]||(l[19]=t=>_.value=t),placeholder:"Search"},{append:s(()=>[o(M,{name:"search"})]),_:1},8,["modelValue"])]),item:s(t=>[m("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:O(t.selected?"transform: scale(0.95);":"")},[o(H,{class:P(t.selected?"bg-grey-2":"")},{default:s(()=>[(f(!0),w(X,null,Y(t.cols,d=>(f(),x(le,{key:d.name},{default:s(()=>[o(I,null,{default:s(()=>[o(T,null,{default:s(()=>[o(I,null,{default:s(()=>[d.name!=="image"?(f(),x(U,{key:0,caption:""},{default:s(()=>[g(Z(d.value),1)]),_:2},1024)):d.name=="image"?(f(),x(q,{key:1,square:""},{default:s(()=>[m("img",{src:t.row.image,alt:""},null,8,re)]),_:2},1024)):j("",!0)]),_:2},1024)]),_:2},1024),o(T,{side:""},{default:s(()=>[o(U,{caption:""})]),_:1})]),_:2},1024)]),_:2},1024))),128)),o(p,null,{default:s(()=>[o(u,{onClick:d=>b(t.row._id)},{default:s(()=>[de]),_:2},1032,["onClick"]),o(u,{onClick:d=>Q(t.row._id)},{default:s(()=>[ue]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["class"])],4)]),"body-cell-edit":s(t=>[o(S,null,{default:s(()=>[o(u,{onClick:d=>b(t.row._id)},{default:s(()=>[me]),_:2},1032,["onClick"]),o(u,{onClick:d=>Q(t.row._id)},{default:s(()=>[pe]),_:2},1032,["onClick"])]),_:2},1024)]),"body-cell-image":s(t=>[o(S,null,{default:s(()=>[o(q,{square:"",size:"100px"},{default:s(()=>[m("img",{src:t.row.image,alt:""},null,8,ce)]),_:2},1024)]),_:2},1024)]),_:1},8,["grid","rows","filter"])])])])}}};export{Le as default};
