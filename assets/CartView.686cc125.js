import{Q as k}from"./QSelect.971ca32f.js";import{y as G,r as P,A as w,c as z,k as d,l as v,f as l,C as a,bc as $,aT as S,D as W,Q as u,B as h,E as Q,n as p,aQ as x,q as X,F as N,a$ as D,K as m,a_ as _,p as ee,H as V,b9 as te,aZ as q,aU as ae,aV as E,J as L}from"./index.a8cc4891.js";import{Q as M}from"./QAvatar.9399627c.js";import{Q as Y,a as O}from"./QItem.5db34851.js";import{Q as le}from"./QList.8d104970.js";import{Q as T}from"./QTd.fcfe3c90.js";import{Q as oe}from"./QTable.855044b7.js";import{Q as ne,a as ie,b as B}from"./QStepper.c356f395.js";import{Q as re}from"./QForm.028c178d.js";import{C as H}from"./ClosePopup.cabadc2a.js";import{v as se}from"./index.0517b504.js";import"./QMenu.15a86a7d.js";import"./selection.4c00b57a.js";import"./rtl.4b414a6d.js";import"./QMarkupTable.48448a8b.js";import"./use-fullscreen.f19dab9e.js";import"./use-panel.6c90b8ba.js";import"./touch.70a9dd44.js";import"./use-cache.b0833c75.js";const ue={class:"q-pa-md"},de=m("-"),me=m("+"),ce=m("delete"),pe=["src"],fe=m("-"),_e=m("+"),ye=m("Delete"),ge=["src"],ve=m("Enter Info"),he=p("div",{class:"text-h6"},"Enter info",-1),Ce=m("edit"),be=p("p",null,"choose the payment",-1),ke=m("checkout"),Oe={__name:"CartView",setup(we){const C=G(),y=P(1),J=[{name:"name",required:!0,label:"Name",align:"left",field:t=>{var o,i;return((o=t.tour)==null?void 0:o.name)||((i=t.activity)==null?void 0:i.name)},format:t=>`${t}`,sortable:!0},{name:"image",align:"center",label:"image",sortable:!0},{name:"edit",label:"quantity",field:t=>t.quantity,sortable:!0},{name:"deleteIt",label:"delete",field:t=>t.quantity,sortable:!0}],r=w([]),U=z(()=>r.reduce((t,o)=>{var i,e;return t+((i=o.tour)==null?void 0:i.price)||((e=o.activity)==null?void 0:e.price)*o.quantity},0)),K=P(""),R=w([t=>!!t||"email is required",t=>se.exports.isEmail(t)||"please enter with email type"]),n=w({_id:"",name:"",email:"",phone:"",idx:-1,dialog:!1,submitting:!1}),A=t=>{n._id=t;const o=t===""?-1:f.findIndex(i=>i._id===t);o>-1?(n.name=f[o].name,n.email=f[o].email,n.phone=f[o].phone):(n.name="",n.email="",n.phone=""),n.idx=o,n.dialog=!0,n.submitting=!1},g=async(t,o)=>{const i=r.findIndex(e=>e._id===t);r[i].tour?await C.updateCart({tour:r[i].tour._id,quantity:o})&&(o===0?r.splice(i,1):r[i].quantity=o):r[i].activity&&await C.updateCart({activity:r[i].activity._id,quantity:o})&&(o===0?r.splice(i,1):r[i].quantity=o)};(async()=>{try{const{data:t}=await $.get("/users/cart");r.splice(0,r.length),r.push(...t.result)}catch(t){console.log(t),S.fire({icon:"error",title:"failed",text:t.isAxiosError?t.response.data.message:t.message})}})();const f=w([]),I=async()=>{try{const{data:t}=await $.get("/users/orderInfo");f.splice(0,r.length),f.push(...t.result)}catch(t){console.log(t),S.fire({icon:"error",title:"failed",text:t.isAxiosError?t.response.data.message:t.message})}};I();const Z=async()=>{n.submitting=!0;try{if(n._id.length===0)C.addOrderInfo({name:n.name,email:n.email,phone:n.phone}),I();else{const{data:t}=await $.patch("/users/orderInfo",{_id:n._id,name:n.name,email:n.email,phone:n.phone});I()}}catch(t){S.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}n.submitting=!1},F=()=>f.length!==0,j=z(()=>r.length>0&&!r.some(t=>{var o,i;return!(((o=t.tour)==null?void 0:o.sell)||((i=t.activity)==null?void 0:i.sell))}));return(t,o)=>{const i=W("q-card-action");return d(),v("div",ue,[l(ne,{modelValue:y.value,"onUpdate:modelValue":o[7]||(o[7]=e=>y.value=e),ref:"stepper",color:"primary",animated:""},{navigation:a(()=>[l(ie,null,{default:a(()=>[l(u,{onClick:o[5]||(o[5]=e=>t.$refs.stepper.next()),color:"primary",label:y.value===4?"Finish":"Continue"},null,8,["label"]),y.value>1?(d(),h(u,{key:0,flat:"",color:"primary",onClick:o[6]||(o[6]=e=>t.$refs.stepper.previous()),label:"Back",class:"q-ml-sm"})):Q("",!0)]),_:1})]),default:a(()=>[l(B,{name:1,title:"My cart",icon:"settings",done:y.value>1},{default:a(()=>[l(oe,{grid:t.$q.screen.lt.md,title:"My Cart",rows:r,columns:J,"row-key":"quantity",filter:K.value},{item:a(e=>[p("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:ee(e.selected?"transform: scale(0.95);":"")},[l(x,{class:X(e.selected?"bg-grey-2":"")},{default:a(()=>[(d(!0),v(N,null,D(e.cols,s=>(d(),h(le,{key:s.name},{default:a(()=>[l(Y,null,{default:a(()=>[l(O,null,{default:a(()=>[l(Y,null,{default:a(()=>[s.name!=="image"&&s.name!=="edit"&&s.name!=="deleteIt"?(d(),h(k,{key:0,caption:""},{default:a(()=>[m(_(s.value),1)]),_:2},1024)):Q("",!0),s.name==="edit"?(d(),h(k,{key:1,caption:""},{default:a(()=>[l(i,null,{default:a(()=>[l(u,{onClick:c=>g(e.row._id,e.row.quantity-1),variant:"text"},{default:a(()=>[de]),_:2},1032,["onClick"]),m(" "+_(s.value)+" ",1),l(u,{onClick:c=>g(e.row._id,e.row.quantity+1),variant:"text"},{default:a(()=>[me]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):Q("",!0),s.name==="deleteIt"?(d(),h(k,{key:2,caption:""},{default:a(()=>[l(i,null,{default:a(()=>[l(u,{onClick:c=>g(e.row._id,0)},{default:a(()=>[ce]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):s.name=="image"?(d(),h(M,{key:3,square:""},{default:a(()=>{var c,b;return[p("img",{src:((c=e.row.tour)==null?void 0:c.image)||((b=e.row.activity)==null?void 0:b.image),alt:""},null,8,pe)]}),_:2},1024)):Q("",!0)]),_:2},1024)]),_:2},1024),l(O,{side:""},{default:a(()=>[l(k,{caption:""})]),_:1})]),_:2},1024)]),_:2},1024))),128))]),_:2},1032,["class"])],4)]),"body-cell-edit":a(e=>[l(T,{edit:e},{default:a(()=>{var s,c;return[l(u,{onClick:b=>g(e.row._id,e.row.quantity-1),variant:"text"},{default:a(()=>[fe]),_:2},1032,["onClick"]),m(" "+_(e.row.quantity)+" ",1),l(u,{onClick:b=>g(e.row._id,e.row.quantity+1),variant:"text"},{default:a(()=>[_e]),_:2},1032,["onClick"]),p("p",null,"price: "+_(((s=e.row.tour)==null?void 0:s.price)||((c=e.row.activity)==null?void 0:c.price)*e.row.quantity)+" NTD",1)]}),_:2},1032,["edit"])]),"body-cell-deleteIt":a(e=>[l(T,null,{default:a(()=>[l(u,{onClick:s=>g(e.row._id,0)},{default:a(()=>[ye]),_:2},1032,["onClick"])]),_:2},1024)]),"body-cell-image":a(e=>[l(T,null,{default:a(()=>[l(M,{square:"",size:"100px"},{default:a(()=>{var s,c;return[p("img",{src:((s=e.row.tour)==null?void 0:s.image)||((c=e.row.activity)==null?void 0:c.image),alt:""},null,8,ge)]}),_:2},1024)]),_:2},1024)]),_:1},8,["grid","rows","filter"]),p("p",null,"Total: "+_(V(U))+" NTD",1)]),_:1},8,["done"]),l(B,{name:2,title:"Enter Info",icon:"create_new_folder",done:y.value>2},{default:a(()=>[l(u,{color:"secondary",onClick:o[0]||(o[0]=e=>A("")),disabled:F()},{default:a(()=>[ve]),_:1},8,["disabled"]),l(te,{modelValue:n.dialog,"onUpdate:modelValue":o[4]||(o[4]=e=>n.dialog=e),persistent:""},{default:a(()=>[l(x,{style:{"min-width":"700px"}},{default:a(()=>[l(q,null,{default:a(()=>[he]),_:1}),l(q,{class:"q-pt-none"},{default:a(()=>[l(re,{onSubmit:ae(Z,["prevent"])},{default:a(()=>[l(E,{filled:"",modelValue:n.name,"onUpdate:modelValue":o[1]||(o[1]=e=>n.name=e),label:"Your name",rules:[e=>e&&e.length>0||"Please enter your name"]},null,8,["modelValue","rules"]),l(E,{filled:"",modelValue:n.email,"onUpdate:modelValue":o[2]||(o[2]=e=>n.email=e),label:"Your email",rules:R},null,8,["modelValue","rules"]),l(E,{filled:"",modelValue:n.phone,"onUpdate:modelValue":o[3]||(o[3]=e=>n.phone=e),label:"Your phone number",rules:[e=>e&&e.length>0||"Please enter your phone number"]},null,8,["modelValue","rules"]),L(l(u,{flat:"",label:"Cancel"},null,512),[[H]]),L(l(u,{flat:"",label:"Save",type:"submit"},null,512),[[H]])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(x,{class:"my-card"},{default:a(()=>[l(q,null,{default:a(()=>[(d(!0),v(N,null,D(f,e=>(d(),v("div",{key:e._id},[p("p",null,"Name: "+_(e.name),1),p("p",null,"email: "+_(e.email),1),p("p",null,"phone: "+_(e.phone),1),l(u,{onClick:s=>A(e._id),flat:""},{default:a(()=>[Ce]),_:2},1032,["onClick"])]))),128))]),_:1})]),_:1})]),_:1},8,["done"]),l(B,{name:3,title:"Check Out",icon:"assignment"},{default:a(()=>[l(x,{class:"my-card"},{default:a(()=>[l(q,null,{default:a(()=>[(d(!0),v(N,null,D(f,e=>(d(),v("div",{key:e._id},[p("p",null,"total: "+_(V(U))+" NTD",1),be]))),128))]),_:1})]),_:1}),l(u,{color:"secondary",onClick:V(C).checkout,disabled:!F()||!V(j)},{default:a(()=>[ke]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["modelValue"])])}}};export{Oe as default};
