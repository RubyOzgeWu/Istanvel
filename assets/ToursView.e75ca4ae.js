import{A as y,r as D,k as f,l as w,n as m,f as a,Q as u,C as s,ba as F,bd as C,aV as p,D as z,aS as H,aW as E,a$ as G,aX as i,bu as J,bx as K,J as v,G as M,p as O,q as P,F as W,b1 as X,B as x,K as g,b0 as j,E as R}from"./index.1af9d501.js";import{Q as Y,a as Z}from"./QToolbar.aea21d78.js";import{Q as h}from"./QFile.8d1da674.js";import{b as k,Q as U}from"./QSelect.4bc5697e.js";import{Q as ee}from"./QForm.c6b3aa45.js";import{Q as q}from"./QAvatar.a9eb7b7a.js";import{Q as I,a as T}from"./QItem.c4254061.js";import{Q as le}from"./QList.f08dd725.js";import{Q as S}from"./QTd.e85e9b99.js";import{Q as te}from"./QTable.5e4768da.js";import{C as L}from"./ClosePopup.246ff774.js";import"./QMenu.7079edfb.js";import"./selection.13c9e09e.js";import"./rtl.4b414a6d.js";import"./QMarkupTable.6ab7694f.js";import"./use-fullscreen.7a1e9363.js";const ae={class:"q-pa-md",id:"ToursView"},oe={class:"row"},se={class:"col-12"},ne=m("span",{class:"text-weight-bold"},"\u65B0\u589E\u5546\u54C1",-1),ie={class:"col-12"},de=["src"],re=g("\u7DE8\u8F2F"),ue=g("\u522A\u9664"),me=g("\u7DE8\u8F2F"),ce=g("\u522A\u9664"),pe=["src"],Se={__name:"ToursView",setup(fe){const $=[{name:"Name",required:!0,label:"\u884C\u7A0B\u540D\u7A31\uFF08\u82F1\u6587\uFF09",align:"left",field:o=>o.name,format:o=>`${o}`,sortable:!0},{name:"ChName",align:"center",label:"\u884C\u7A0B\u540D\u7A31\uFF08\u4E2D\u6587\uFF09",field:o=>o.CH_name,sortable:!0},{name:"image",align:"center",label:"\u7167\u7247",sortable:!0},{name:"Category",label:"\u884C\u7A0B\u5206\u985E\uFF08\u82F1\u6587\uFF09",field:o=>o.category,sortable:!0},{name:"edit",label:"\u7DE8\u8F2F",sortable:!0}],n=y([]),b=D(""),e=y({_id:"",name:"",CH_name:"",description:"",CH_description:"",departureLocation:"",departureTime:"",included:"",CH_included:"",notIncluded:"",CH_notIncluded:"",note:"",CH_note:"",image:null,price:0,category:"",CH_category:"",sell:!1,idx:-1,dialog:!1,valid:!1,submitting:!1}),A=["History & Culture","Nature","sacred religion","shopping & experience","cruisine"],N=["\u6B77\u53F2\u6587\u5316","\u81EA\u7136","\u5B97\u6559","\u8CFC\u7269","\u7F8E\u98DF"],d=y({required(o){return!!o||"\u5FC5\u586B"},price(o){return o>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(o){var l,c,t;return!o||!o.length||((c=(l=o[0])==null?void 0:l.type)==null?void 0:c.includes("image"))&&((t=o[0])==null?void 0:t.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),_=o=>{e._id=o;const l=o===""?-1:n.findIndex(c=>c._id===o);l>-1?(e.name=n[l].name,e.CH_name=n[l].CH_name,e.description=n[l].description,e.CH_description=n[l].CH_description,e.departureLocation=n[l].departureLocation,e.departureTime=n[l].departureTime,e.included=n[l].included,e.CH_included=n[l].CH_included,e.notIncluded=n[l].notIncluded,e.CH_notIncluded=n[l].CH_notIncluded,e.note=n[l].note,e.CH_note=n[l].CH_note,e.image=n[l].image,e.price=n[l].price,e.category=n[l].category,e.CH_category=n[l].CH_category,e.sell=n[l].sell):(e.name="",e.CH_name="",e.description="",e.CH_description="",e.departureLocation="",e.departureTime="",e.included="",e.CH_included="",e.notIncluded="",e.CH_notIncluded="",e.note="",e.CH_note="",e.price=0,e.category="",e.CH_category="",e.sell=!1,e.description=""),e.image=null,e.idx=l,e.dialog=!0,e.valid=!1,e.submitting=!1},B=async()=>{e.submitting=!0;const o=new FormData;for(const l in e)["_id","idx","dialog","valid","submitting"].includes(l)||o.append(l,e[l]);try{if(e._id.length===0){const{data:l}=await C.post("/tours",o);n.push(l.result),p.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"}),V()}else{const{data:l}=await C.patch("/tours/"+e._id,o);n[e.idx]=l.result,p.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),V()}e.dialog=!1}catch(l){p.fire({icon:"error",title:"\u5931\u6557",text:l.isAxiosError?l.response.data.message:l.message})}e.submitting=!1},V=async()=>{try{const{data:o}=await C.get("/tours/all");n.splice(0,n.length),n.push(...o.result)}catch(o){console.log(o),p.fire({icon:"error",title:"\u5931\u6557",text:o.isAxiosError?o.response.data.message:o.message})}};V();const Q=async o=>{console.log(o);try{await C.delete("/tours/"+o),await p.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"}),V()}catch(l){await p.fire({icon:"success",title:"\u5931\u6557",text:l.isAxiosError&&l.response.data?l.response.data.message:"\u767C\u751F\u932F\u8AA4"})}};return(o,l)=>{const c=z("q-card-action");return f(),w("div",ae,[m("div",oe,[m("div",se,[a(u,{label:"\u65B0\u589E\u884C\u7A0B",color:"secondary",onClick:l[0]||(l[0]=t=>_(""))}),a(F,{modelValue:e.dialog,"onUpdate:modelValue":l[18]||(l[18]=t=>e.dialog=t),persistent:""},{default:s(()=>[a(H,{style:{width:"700px","max-width":"80vw"}},{default:s(()=>[a(Y,null,{default:s(()=>[a(Z,null,{default:s(()=>[ne]),_:1})]),_:1}),a(ee,{modelValue:e.valid,"onUpdate:modelValue":l[17]||(l[17]=t=>e.valid=t),onSubmit:E(B,["prevent"])},{default:s(()=>[a(H,null,{default:s(()=>[a(G,{class:"q-pt-none"},{default:s(()=>[a(i,{dense:"",modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.name=t),autofocus:"",label:"\u884C\u7A0B\u540D\u7A31(\u82F1\u6587)",rules:[d.required]},null,8,["modelValue","rules"]),a(i,{dense:"",modelValue:e.CH_name,"onUpdate:modelValue":l[2]||(l[2]=t=>e.CH_name=t),autofocus:"",label:"\u884C\u7A0B\u540D\u7A31(\u4E2D\u6587)",rules:[d.required]},null,8,["modelValue","rules"]),a(i,{dense:"",modelValue:e.description,"onUpdate:modelValue":l[3]||(l[3]=t=>e.description=t),autofocus:"",type:"textarea",label:"\u884C\u7A0B\u6558\u8FF0(\u82F1\u6587)",rules:[d.required]},null,8,["modelValue","rules"]),a(i,{dense:"",modelValue:e.CH_description,"onUpdate:modelValue":l[4]||(l[4]=t=>e.CH_description=t),autofocus:"",type:"textarea",label:"\u884C\u7A0B\u6558\u8FF0\uFF08\u4E2D\u6587\uFF09",rules:[d.required]},null,8,["modelValue","rules"]),a(i,{dense:"",modelValue:e.departureLocation,"onUpdate:modelValue":l[5]||(l[5]=t=>e.departureLocation=t),autofocus:"",label:"\u96C6\u5408\u5730\u9EDE"},null,8,["modelValue"]),a(i,{dense:"",modelValue:e.departureTime,"onUpdate:modelValue":l[6]||(l[6]=t=>e.departureTime=t),autofocus:"",label:"\u96C6\u5408\u6642\u9593"},null,8,["modelValue"]),a(i,{dense:"",modelValue:e.included,"onUpdate:modelValue":l[7]||(l[7]=t=>e.included=t),autofocus:"",type:"textarea",label:"\u5305\u542B\uFF08\u82F1\u6587\uFF09"},null,8,["modelValue"]),a(i,{dense:"",modelValue:e.CH_included,"onUpdate:modelValue":l[8]||(l[8]=t=>e.CH_included=t),autofocus:"",type:"textarea",label:"\u5305\u542B\uFF08\u4E2D\u6587\uFF09"},null,8,["modelValue"]),a(i,{dense:"",modelValue:e.note,"onUpdate:modelValue":l[9]||(l[9]=t=>e.note=t),autofocus:"",type:"textarea",label:"\u5099\u8A3B\uFF08\u82F1\u6587\uFF09"},null,8,["modelValue"]),a(i,{dense:"",modelValue:e.CH_note,"onUpdate:modelValue":l[10]||(l[10]=t=>e.CH_note=t),autofocus:"",type:"textarea",label:"\u5099\u8A3B\uFF08\u4E2D\u6587\uFF09"},null,8,["modelValue"]),a(h,{dense:"",modelValue:e.image,"onUpdate:modelValue":l[11]||(l[11]=t=>e.image=t),autofocus:"",label:"\u7167\u7247"},null,8,["modelValue"]),a(i,{dense:"",modelValue:e.price,"onUpdate:modelValue":l[12]||(l[12]=t=>e.price=t),autofocus:"",label:"\u50F9\u683C",rules:[d.required,d.price]},null,8,["modelValue","rules"]),a(k,{modelValue:e.category,"onUpdate:modelValue":l[13]||(l[13]=t=>e.category=t),options:A,label:"\u884C\u7A0B\u5206\u985E\uFF08\u82F1\u6587\uFF09",rules:[d.required]},null,8,["modelValue","rules"]),a(k,{modelValue:e.CH_category,"onUpdate:modelValue":l[14]||(l[14]=t=>e.CH_category=t),options:N,label:"\u884C\u7A0B\u5206\u985E\uFF08\u4E2D\u6587\uFF09",rules:[d.required]},null,8,["modelValue","rules"]),a(J,{modelValue:e.sell,"onUpdate:modelValue":l[15]||(l[15]=t=>e.sell=t),label:"\u4E0A\u67B6",color:"teal"},null,8,["modelValue"])]),_:1}),a(K,{align:"right",class:"text-primary"},{default:s(()=>[v(a(u,{flat:"",type:"submit",loading:e.submitting,label:"\u78BA\u5B9A"},null,8,["loading"]),[[L]]),v(a(u,{flat:"",label:"\u53D6\u6D88",onClick:l[16]||(l[16]=t=>e.dialog=!1),disabled:e.submitting},null,8,["disabled"]),[[L]])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),m("div",ie,[a(te,{grid:o.$q.screen.lt.md,title:"\u884C\u7A0B\u7BA1\u7406",rows:n,columns:$,"row-key":"name",filter:b.value},{"top-right":s(()=>[a(i,{borderless:"",dense:"",debounce:"300",modelValue:b.value,"onUpdate:modelValue":l[19]||(l[19]=t=>b.value=t),placeholder:"Search"},{append:s(()=>[a(M,{name:"search"})]),_:1},8,["modelValue"])]),item:s(t=>[m("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:O(t.selected?"transform: scale(0.95);":"")},[a(H,{class:P(t.selected?"bg-grey-2":"")},{default:s(()=>[(f(!0),w(W,null,X(t.cols,r=>(f(),x(le,{key:r.name},{default:s(()=>[a(I,null,{default:s(()=>[a(T,null,{default:s(()=>[a(I,null,{default:s(()=>[r.name!=="image"?(f(),x(U,{key:0,caption:""},{default:s(()=>[g(j(r.value),1)]),_:2},1024)):r.name=="image"?(f(),x(q,{key:1,square:""},{default:s(()=>[m("img",{src:t.row.image,alt:""},null,8,de)]),_:2},1024)):R("",!0)]),_:2},1024)]),_:2},1024),a(T,{side:""},{default:s(()=>[a(U,{caption:""})]),_:1})]),_:2},1024)]),_:2},1024))),128)),a(c,null,{default:s(()=>[a(u,{onClick:r=>_(t.row._id)},{default:s(()=>[re]),_:2},1032,["onClick"]),a(u,{onClick:r=>Q(t.row._id)},{default:s(()=>[ue]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["class"])],4)]),"body-cell-edit":s(t=>[a(S,null,{default:s(()=>[a(u,{onClick:r=>_(t.row._id)},{default:s(()=>[me]),_:2},1032,["onClick"]),a(u,{onClick:r=>Q(t.row._id)},{default:s(()=>[ce]),_:2},1032,["onClick"])]),_:2},1024)]),"body-cell-image":s(t=>[a(S,null,{default:s(()=>[a(q,{square:"",size:"100px"},{default:s(()=>[m("img",{src:t.row.image,alt:""},null,8,pe)]),_:2},1024)]),_:2},1024)]),_:1},8,["grid","rows","filter"])])])])}}};export{Se as default};
