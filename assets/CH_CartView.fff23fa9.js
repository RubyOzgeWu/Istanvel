import{Q as b}from"./QSelect.0f440de0.js";import{r as U,C as X,E as h,c as j,k as m,l as k,f as l,H as a,bd as Q,aV as x,I as K,Q as d,G as y,J as w,n as p,aS as V,q as Y,F as A,b1 as D,O as u,b0 as v,p as Z,ba as ee,a$ as I,aW as te,aX as $,N as F,L}from"./index.11fd6517.js";import{Q as z}from"./QAvatar.12229989.js";import{Q as O,a as T}from"./QItem.e343114c.js";import{Q as ae}from"./QList.880520c2.js";import{Q as q}from"./QTd.2dbf11ef.js";import{Q as le}from"./QTable.54899264.js";import{Q as oe,a as se,b as S}from"./QStepper.304868d5.js";import{Q as ne}from"./QForm.bebefe84.js";import{C as M}from"./ClosePopup.d5ffe5c0.js";import{v as ie}from"./index.0517b504.js";import"./QMenu.c74a33be.js";import"./selection.70e98c8c.js";import"./rtl.4b414a6d.js";import"./QMarkupTable.d1786a0a.js";import"./use-fullscreen.47f94278.js";import"./use-panel.33b78e58.js";import"./touch.70a9dd44.js";import"./use-cache.b0833c75.js";const re={class:"q-pa-md"},de=u("-"),ue=u("+"),me=u("delete"),ce=["src"],fe=u("-"),pe=u("+"),_e=u("\u522A\u9664"),ge=["src"],ye=u("\u65B0\u589E\u8A02\u8CFC\u8CC7\u6599"),ve=p("div",{class:"text-h6"},"\u65B0\u589E\u8A02\u8CFC\u8CC7\u6599",-1),Ce=u("\u7DE8\u8F2F"),be=u("\u7D50\u5E33"),Te={__name:"CH_CartView",setup(he){const _=U(1),C=X(),G=[{name:"name",required:!0,label:"Name",align:"left",field:t=>{var o,n;return((o=t.tour)==null?void 0:o.CH_name)||((n=t.activity)==null?void 0:n.CH_name)},format:t=>`${t}`,sortable:!0},{name:"image",align:"center",label:"\u7167\u7247",sortable:!0},{name:"edit",label:"\u6578\u91CF",field:t=>t.quantity,sortable:!0},{name:"deleteIt",label:"\u522A\u9664",field:t=>t.quantity,sortable:!0}],i=h([]),J=U(""),P=h([t=>!!t||"\u4FE1\u7BB1\u5FC5\u586B",t=>ie.exports.isEmail(t)||"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u4FE1\u7BB1\u683C\u5F0F"]),s=h({_id:"",name:"",email:"",phone:"",idx:-1,dialog:!1,submitting:!1}),E=t=>{s._id=t;const o=t===""?-1:c.findIndex(n=>n._id===t);o>-1?(s.name=c[o].name,s.email=c[o].email,s.phone=c[o].phone):(s.name="",s.email="",s.phone=""),s.idx=o,s.dialog=!0,s.submitting=!1},g=async(t,o)=>{const n=i.findIndex(e=>e._id===t);i[n].tour?await C.updateCart({tour:i[n].tour._id,quantity:o})&&(o===0?i.splice(n,1):i[n].quantity=o):i[n].activity&&await C.updateCart({activity:i[n].activity._id,quantity:o})&&(o===0?i.splice(n,1):i[n].quantity=o)};(async()=>{try{const{data:t}=await Q.get("/users/cart");i.splice(0,i.length),i.push(...t.result)}catch(t){x.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}})();const c=h([]),N=async()=>{try{const{data:t}=await Q.get("/users/orderInfo");c.splice(0,i.length),c.push(...t.result)}catch(t){console.log(t),x.fire({icon:"error",title:"failed",text:t.isAxiosError?t.response.data.message:t.message})}};N();const R=async()=>{s.submitting=!0;try{if(s._id.length===0)C.CH_addOrderInfo({name:s.name,email:s.email,phone:s.phone});else{const{data:t}=await Q.patch("/users/orderInfo",{_id:s._id,name:s.name,email:s.email,phone:s.phone})}N()}catch(t){x.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}s.submitting=!1},B=()=>(console.log(c),c.length!==0),W=j(()=>i.length>0&&!i.some(t=>{var o,n;return!(((o=t.tour)==null?void 0:o.sell)||((n=t.activity)==null?void 0:n.sell))}));return(t,o)=>{const n=K("q-card-action");return m(),k("div",re,[l(oe,{modelValue:_.value,"onUpdate:modelValue":o[7]||(o[7]=e=>_.value=e),ref:"stepper",color:"primary",animated:""},{navigation:a(()=>[l(se,null,{default:a(()=>[l(d,{onClick:o[5]||(o[5]=e=>t.$refs.stepper.next()),color:"primary",label:_.value===4?"Finish":"Continue"},null,8,["label"]),_.value>1?(m(),y(d,{key:0,flat:"",color:"primary",onClick:o[6]||(o[6]=e=>t.$refs.stepper.previous()),label:"Back",class:"q-ml-sm"})):w("",!0)]),_:1})]),default:a(()=>[l(S,{name:1,title:"My Cart",icon:"settings",done:_.value>1},{default:a(()=>[l(le,{grid:t.$q.screen.xs,title:"\u6211\u7684\u8CFC\u7269\u8ECA",rows:i,columns:G,"row-key":"name",filter:J.value,"hide-header":""},{item:a(e=>[p("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:Z(e.selected?"transform: scale(0.95);":"")},[l(V,{class:Y(e.selected?"bg-grey-2":"")},{default:a(()=>[(m(!0),k(A,null,D(e.cols,r=>(m(),y(ae,{key:r.name},{default:a(()=>[l(O,null,{default:a(()=>[l(T,null,{default:a(()=>[l(O,null,{default:a(()=>[r.name!=="image"&&r.name!=="edit"&&r.name!=="deleteIt"?(m(),y(b,{key:0,caption:""},{default:a(()=>[u(v(r.value),1)]),_:2},1024)):w("",!0),r.name==="edit"?(m(),y(b,{key:1,caption:""},{default:a(()=>[l(n,null,{default:a(()=>[l(d,{onClick:f=>g(e.row._id,e.row.quantity-1),variant:"text"},{default:a(()=>[de]),_:2},1032,["onClick"]),u(" "+v(r.value)+" ",1),l(d,{onClick:f=>g(e.row._id,e.row.quantity+1),variant:"text"},{default:a(()=>[ue]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):w("",!0),r.name==="deleteIt"?(m(),y(b,{key:2,caption:""},{default:a(()=>[l(n,null,{default:a(()=>[l(d,{onClick:f=>g(e.row._id,0)},{default:a(()=>[me]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):r.name=="image"?(m(),y(z,{key:3,square:""},{default:a(()=>{var f,H;return[p("img",{src:((f=e.row.tour)==null?void 0:f.image)||((H=e.row.activity)==null?void 0:H.image),alt:""},null,8,ce)]}),_:2},1024)):w("",!0)]),_:2},1024)]),_:2},1024),l(T,{side:""},{default:a(()=>[l(b,{caption:""})]),_:1})]),_:2},1024)]),_:2},1024))),128))]),_:2},1032,["class"])],4)]),"body-cell-edit":a(e=>[l(q,{edit:e},{default:a(()=>[l(d,{onClick:r=>g(e.row._id,e.row.quantity-1),variant:"text"},{default:a(()=>[fe]),_:2},1032,["onClick"]),u(" "+v(e.row.quantity)+" ",1),l(d,{onClick:r=>g(e.row._id,e.row.quantity+1),variant:"text"},{default:a(()=>[pe]),_:2},1032,["onClick"])]),_:2},1032,["edit"])]),"body-cell-deleteIt":a(e=>[l(q,null,{default:a(()=>[l(d,{onClick:r=>g(e.row._id,0)},{default:a(()=>[_e]),_:2},1032,["onClick"])]),_:2},1024)]),"body-cell-image":a(e=>[l(q,null,{default:a(()=>[l(z,{square:"",size:"100px"},{default:a(()=>{var r,f;return[p("img",{src:((r=e.row.tour)==null?void 0:r.image)||((f=e.row.activity)==null?void 0:f.image),alt:""},null,8,ge)]}),_:2},1024)]),_:2},1024)]),_:1},8,["grid","rows","filter"])]),_:1},8,["done"]),l(S,{name:2,title:"Enter Info",icon:"create_new_folder",done:_.value>2},{default:a(()=>[l(d,{color:"secondary",onClick:o[0]||(o[0]=e=>E("")),disabled:B()},{default:a(()=>[ye]),_:1},8,["disabled"]),l(ee,{modelValue:s.dialog,"onUpdate:modelValue":o[4]||(o[4]=e=>s.dialog=e),persistent:""},{default:a(()=>[l(V,{style:{"min-width":"700px"}},{default:a(()=>[l(I,null,{default:a(()=>[ve]),_:1}),l(I,{class:"q-pt-none"},{default:a(()=>[l(ne,{onSubmit:te(R,["prevent"])},{default:a(()=>[l($,{filled:"",modelValue:s.name,"onUpdate:modelValue":o[1]||(o[1]=e=>s.name=e),label:"\u8A02\u8CFC\u4EBA\u59D3\u540D",rules:[e=>e&&e.length>0||"\u8ACB\u8F38\u5165\u8A02\u8CFC\u4EBA\u59D3\u540D"]},null,8,["modelValue","rules"]),l($,{filled:"",modelValue:s.email,"onUpdate:modelValue":o[2]||(o[2]=e=>s.email=e),label:"\u8A02\u8CFC\u4EBA\u4FE1\u7BB1",rules:P},null,8,["modelValue","rules"]),l($,{filled:"",modelValue:s.phone,"onUpdate:modelValue":o[3]||(o[3]=e=>s.phone=e),label:"\u806F\u7D61\u96FB\u8A71",rules:[e=>e&&e.length>0||"\u8ACB\u8F38\u5165\u8A02\u8CFC\u4EBA\u96FB\u8A71"]},null,8,["modelValue","rules"]),F(l(d,{flat:"",label:"\u53D6\u6D88"},null,512),[[M]]),F(l(d,{flat:"",label:"\u5132\u5B58",type:"submit"},null,512),[[M]])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(V,{class:"my-card"},{default:a(()=>[l(I,null,{default:a(()=>[(m(!0),k(A,null,D(c,e=>(m(),k("div",{key:e._id},[p("p",null,"\u8A02\u8CFC\u4EBA\u59D3\u540D: "+v(e.name),1),p("p",null,"\u8A02\u8CFC\u4EBA\u4FE1\u7BB1: "+v(e.email),1),p("p",null,"\u806F\u7D61\u96FB\u8A71: "+v(e.phone),1),l(d,{onClick:r=>E(e._id),flat:""},{default:a(()=>[Ce]),_:2},1032,["onClick"])]))),128))]),_:1})]),_:1})]),_:1},8,["done"]),l(S,{name:3,title:"Check Out",icon:"assignment"},{default:a(()=>[l(d,{color:"secondary",onClick:L(C).CH_checkout,disabled:!B()||!L(W)},{default:a(()=>[be]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["modelValue"])])}}};export{Te as default};
