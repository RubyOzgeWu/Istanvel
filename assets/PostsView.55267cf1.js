import{A as y,r as D,l as p,m as v,p as f,f as o,Q as d,C as s,b6 as F,D as I,aQ as Q,aS as B,aX as T,aT as u,bp as E,bs as z,J as H,G as N,q as L,t as G,F as P,aZ as J,B as x,K as g,aY as K,E as M}from"./index.ba8e8a10.js";import{Q as X,a as Y}from"./QToolbar.14de37ee.js";import{b as Z,Q as h}from"./QSelect.665ed341.js";import{Q as j}from"./QFile.26272de4.js";import{Q as O}from"./QForm.82a065a9.js";import{Q as R}from"./QAvatar.12db997d.js";import{Q as k,a as q}from"./QItem.5fa24591.js";import{Q as W}from"./QList.a026841d.js";import{Q as ee}from"./QTable.4153bee3.js";import{C as U}from"./ClosePopup.04c8406c.js";import{b as _,S as c}from"./user.63492ea5.js";import"./QMenu.90b0984d.js";import"./selection.9debefde.js";import"./rtl.4b414a6d.js";import"./QMarkupTable.f907ef64.js";import"./use-fullscreen.3197ee31.js";const te={class:"q-pa-md"},le={class:"row"},ae={class:"col-12"},oe=f("span",{class:"text-weight-bold"},"\u65B0\u589E\u5546\u54C1",-1),se={class:"col-12"},re=g("\u7DE8\u8F2F"),ie=g("\u522A\u9664"),ne=["src"],ue=g("\u7DE8\u8F2F"),de=g("\u522A\u9664"),qe={__name:"PostsView",setup(me){const S=[{name:"title",required:!0,label:"\u82F1\u6587\u6A19\u984C",align:"left",field:l=>l.title,format:l=>`${l}`,sortable:!0},{name:"CH_title",align:"center",label:"\u4E2D\u6587\u6A19\u984C",field:l=>l.CH_title,sortable:!0},{name:"author",align:"center",label:"Author",field:l=>l.author,sortable:!0},{name:"date",align:"center",label:"Date",field:l=>l.date,sortable:!0},{name:"category",align:"center",label:"Category",field:l=>l.category,sortable:!0},{name:"edit",label:"\u7DE8\u8F2F",sortable:!0}],r=y([]),C=D(""),t=y({_id:"",title:"",CH_title:"",author:"",CH_author:"",content:"",CH_content:"",date:"",image:null,category:"",sell:!1,idx:-1,dialog:!1,valid:!1,submitting:!1}),A=["History","Geography","Culture & Foods"],i=y({required(l){return!!l||"\u5FC5\u586B"},price(l){return l>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(l){var e,m,a;return!l||!l.length||((m=(e=l[0])==null?void 0:e.type)==null?void 0:m.includes("image"))&&((a=l[0])==null?void 0:a.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),V=l=>{t._id=l;const e=l===""?-1:r.findIndex(m=>m._id===l);e>-1?(t.title=r[e].title,t.CH_title=r[e].CH_title,t.author=r[e].author,t.CH_author=r[e].CH_author,t.content=r[e].content,t.CH_content=r[e].CH_content,t.date=r[e].date,t.category=r[e].category,t.sell=r[e].sell):(t.title="",t.CH_title="",t.author="",t.CH_author="",t.content="",t.CH_content="",t.date="",t.category="",t.sell=!1),t.image=null,t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},$=async()=>{t.submitting=!0;const l=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||l.append(e,t[e]);try{if(t._id.length===0){const{data:e}=await _.post("/posts",l);r.push(e.result),c.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"}),b()}else{const{data:e}=await _.patch("/posts/"+t._id,l);r[t.idx]=e.result,c.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),b()}t.dialog=!1}catch(e){c.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1},b=async()=>{try{const{data:l}=await _.get("/posts/all");r.splice(0,r.length),r.push(...l.result)}catch(l){console.log(l),c.fire({icon:"error",title:"\u5931\u6557",text:l.isAxiosError?l.response.data.message:l.message})}};b();const w=async l=>{console.log(l);try{await _.delete("/posts/"+l),await c.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"}),b()}catch(e){await c.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError&&e.response.data?e.response.data.message:"\u767C\u751F\u932F\u8AA4"})}};return(l,e)=>{const m=I("q-card-action");return p(),v("div",te,[f("div",le,[f("div",ae,[o(d,{label:"\u65B0\u589E\u6587\u7AE0",color:"secondary",onClick:e[0]||(e[0]=a=>V(""))}),o(F,{modelValue:t.dialog,"onUpdate:modelValue":e[13]||(e[13]=a=>t.dialog=a),persistent:""},{default:s(()=>[o(Q,{style:{"min-width":"700px"}},{default:s(()=>[o(X,null,{default:s(()=>[o(Y,null,{default:s(()=>[oe]),_:1})]),_:1}),o(O,{modelValue:t.valid,"onUpdate:modelValue":e[12]||(e[12]=a=>t.valid=a),onSubmit:B($,["prevent"])},{default:s(()=>[o(Q,null,{default:s(()=>[o(T,{class:"q-pt-none"},{default:s(()=>[o(u,{dense:"",modelValue:t.title,"onUpdate:modelValue":e[1]||(e[1]=a=>t.title=a),autofocus:"",label:"\u6587\u7AE0\u6A19\u984C(\u82F1\u6587)",rules:[i.required]},null,8,["modelValue","rules"]),o(u,{dense:"",modelValue:t.CH_title,"onUpdate:modelValue":e[2]||(e[2]=a=>t.CH_title=a),autofocus:"",label:"\u6587\u7AE0\u6A19\u984C\uFF08\u4E2D\u6587\uFF09",rules:[i.required]},null,8,["modelValue","rules"]),o(u,{dense:"",modelValue:t.author,"onUpdate:modelValue":e[3]||(e[3]=a=>t.author=a),autofocus:"",label:"\u6587\u7AE0\u4F5C\u8005\uFF08\u82F1\u6587\uFF09",rules:[i.required]},null,8,["modelValue","rules"]),o(u,{dense:"",modelValue:t.CH_author,"onUpdate:modelValue":e[4]||(e[4]=a=>t.CH_author=a),autofocus:"",label:"\u6587\u7AE0\u4F5C\u8005\uFF08\u4E2D\u6587\uFF09",rules:[i.required]},null,8,["modelValue","rules"]),o(u,{dense:"",modelValue:t.content,"onUpdate:modelValue":e[5]||(e[5]=a=>t.content=a),type:"textarea",autofocus:"",label:"\u6587\u7AE0\u5167\u5BB9\uFF08\u82F1\u6587\uFF09",rules:[i.required]},null,8,["modelValue","rules"]),o(u,{dense:"",modelValue:t.CH_content,"onUpdate:modelValue":e[6]||(e[6]=a=>t.CH_content=a),type:"textarea",autofocus:"",label:"\u6587\u7AE0\u5167\u5BB9\uFF08\u4E2D\u6587\uFF09",rules:[i.required]},null,8,["modelValue","rules"]),o(u,{dense:"",modelValue:t.date,"onUpdate:modelValue":e[7]||(e[7]=a=>t.date=a),autofocus:"",label:"\u4E0A\u50B3\u65E5\u671F",rules:[i.required]},null,8,["modelValue","rules"]),o(Z,{modelValue:t.category,"onUpdate:modelValue":e[8]||(e[8]=a=>t.category=a),options:A,label:"\u6587\u7AE0\u5206\u985E",rules:[i.required]},null,8,["modelValue","rules"]),o(j,{dense:"",modelValue:t.image,"onUpdate:modelValue":e[9]||(e[9]=a=>t.image=a),autofocus:"",label:"\u7167\u7247"},null,8,["modelValue"]),o(E,{modelValue:t.sell,"onUpdate:modelValue":e[10]||(e[10]=a=>t.sell=a),label:"\u4E0A\u50B3\u6587\u7AE0",color:"teal"},null,8,["modelValue"])]),_:1}),o(z,{align:"right",class:"text-primary"},{default:s(()=>[H(o(d,{flat:"",type:"submit",loading:t.submitting,label:"\u78BA\u5B9A"},null,8,["loading"]),[[U]]),H(o(d,{flat:"",label:"\u53D6\u6D88",onClick:e[11]||(e[11]=a=>t.dialog=!1),disabled:t.submitting},null,8,["disabled"]),[[U]])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),f("div",se,[o(ee,{grid:l.$q.screen.lt.md,title:"\u6587\u7AE0\u7BA1\u7406",rows:r,columns:S,"row-key":"name",filter:C.value,"hide-header":""},{"top-right":s(()=>[o(u,{borderless:"",dense:"",debounce:"300",modelValue:C.value,"onUpdate:modelValue":e[14]||(e[14]=a=>C.value=a),placeholder:"Search"},{append:s(()=>[o(N,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-edit":s(a=>[o(d,{onClick:n=>V(a.row._id)},{default:s(()=>[re]),_:2},1032,["onClick"]),o(d,{onClick:n=>w(a.row._id)},{default:s(()=>[ie]),_:2},1032,["onClick"])]),item:s(a=>[f("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:L(a.selected?"transform: scale(0.95);":"")},[o(Q,{class:G(a.selected?"bg-grey-2":"")},{default:s(()=>[(p(!0),v(P,null,J(a.cols,n=>(p(),x(W,{key:n.name},{default:s(()=>[o(k,null,{default:s(()=>[o(q,null,{default:s(()=>[o(k,null,{default:s(()=>[n.name!=="image"?(p(),x(h,{key:0,caption:""},{default:s(()=>[g(K(n.value),1)]),_:2},1024)):n.name=="image"?(p(),x(R,{key:1,square:""},{default:s(()=>[f("img",{src:a.row.image,alt:""},null,8,ne)]),_:2},1024)):M("",!0)]),_:2},1024)]),_:2},1024),o(q,{side:""},{default:s(()=>[o(h,{caption:""})]),_:1})]),_:2},1024)]),_:2},1024))),128)),o(m,null,{default:s(()=>[o(d,{onClick:n=>V(a.row._id)},{default:s(()=>[ue]),_:2},1032,["onClick"]),o(d,{onClick:n=>w(a.row._id)},{default:s(()=>[de]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["class"])],4)]),_:1},8,["grid","rows","filter"])])])])}}};export{qe as default};
