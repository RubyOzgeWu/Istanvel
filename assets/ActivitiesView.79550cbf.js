import{A as y,r as B,l as f,m as x,p as m,f as o,Q as u,C as s,b6 as F,D as N,aQ as Q,aS as h,aX as z,aT as n,bp as L,bs as R,J as k,G,q as J,t as K,F as M,aZ as O,B as w,K as g,aY as P,E as X}from"./index.2dd91d1a.js";import{Q as Y,a as Z}from"./QToolbar.64e6804e.js";import{b as H,Q as S}from"./QSelect.1d3b3390.js";import{Q as j}from"./QFile.3a4dd429.js";import{Q as W}from"./QForm.0ada9d0b.js";import{Q as q}from"./QAvatar.3187afed.js";import{Q as U,a as E}from"./QItem.af45d9e8.js";import{Q as ee}from"./QList.b700af0b.js";import{Q as le}from"./QTd.06ccfbb5.js";import{Q as te}from"./QTable.fe3697d5.js";import{C as D}from"./ClosePopup.ab3b4512.js";import{b as V,S as p}from"./user.0f3afc9a.js";import"./QMenu.6fe1a7c2.js";import"./selection.0a2eb727.js";import"./rtl.4b414a6d.js";import"./QMarkupTable.0d439ea0.js";import"./use-fullscreen.655b49f1.js";const ae={class:"q-pa-md"},oe={class:"row"},se={class:"col-12"},ie=m("span",{class:"text-weight-bold"},"\u65B0\u589E\u5546\u54C1",-1),ne={class:"col-12"},re=["src"],de=g("\u7DE8\u8F2F"),ue=g("\u522A\u9664"),me=g("\u7DE8\u8F2F"),ce=g("\u522A\u9664"),pe=["src"],Ae={__name:"ActivitiesView",setup(fe){const A=[{name:"Name",required:!0,label:"\u6D3B\u52D5\u540D\u7A31\uFF08\u82F1\u6587\uFF09",align:"left",field:a=>a.name,format:a=>`${a}`,sortable:!0},{name:"ChName",align:"center",label:"\u6D3B\u52D5\u540D\u7A31\uFF08\u4E2D\u6587\uFF09",field:a=>a.CH_name,sortable:!0},{name:"image",align:"center",label:"\u7167\u7247",sortable:!0},{name:"Description",align:"center",label:"\u6D3B\u52D5\u4ECB\u7D39\uFF08\u82F1\u6587\uFF09",field:a=>a.description,sortable:!0},{name:"ChDescription",align:"center",label:"\u6D3B\u52D5\u4ECB\u7D39\uFF08\u4E2D\u6587\uFF09",field:a=>a.CH_description,sortable:!0},{name:"DateStart",label:"Category",field:a=>a.dateStart,sortable:!0},{name:"DateEnd",label:"Category",field:a=>a.dateEnd,sortable:!0},{name:"edit",label:"\u7DE8\u8F2F\u522A\u9664",sortable:!0}],i=y([]),C=B(""),e=y({_id:"",name:"",CH_name:"",description:"",CH_description:"",image:null,location:"",dateStart:"",dateEnd:"",time:"",price:0,category:"",CH_category:"",sell:!1,idx:-1,dialog:!1,valid:!1,submitting:!1}),I=["Art & Design","Technology & Science","Food","Industry","Business"],T=["\u85DD\u8853\u8A2D\u8A08","\u79D1\u6280\u8207\u79D1\u5B78","\u98DF\u7269","\u7522\u696D","\u5546\u696D"],r=y({required(a){return!!a||"\u5FC5\u586B"},price(a){return a>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(a){var l,c,t;return!a||!a.length||((c=(l=a[0])==null?void 0:l.type)==null?void 0:c.includes("image"))&&((t=a[0])==null?void 0:t.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),_=a=>{e._id=a;const l=a===""?-1:i.findIndex(c=>c._id===a);l>-1?(e.name=i[l].name,e.CH_name=i[l].CH_name,e.description=i[l].description,e.CH_description=i[l].CH_description,e.location=i[l].location,e.dateStart=i[l].dateStart,e.dateEnd=i[l].dateEnd,e.time=i[l].time,e.price=i[l].price,e.category=i[l].category,e.CH_category=i[l].CH_category,e.sell=i[l].sell):(e.name="",e.CH_name="",e.description="",e.CH_description="",e.location="",e.dateStart="",e.dateEnd="",e.time="",e.price=0,e.category="",e.CH_category="",e.sell=!1),e.image=null,e.idx=l,e.dialog=!0,e.valid=!1,e.submitting=!1},$=async()=>{e.submitting=!0;const a=new FormData;for(const l in e)["_id","idx","dialog","valid","submitting"].includes(l)||a.append(l,e[l]);try{if(e._id.length===0){const{data:l}=await V.post("/activities",a);i.splice(0,i.length),i.push(l.result),p.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"}),b()}else{const{data:l}=await V.patch("/activities/"+e._id,a);i[e.idx]=l.result,p.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),b()}e.dialog=!1}catch(l){p.fire({icon:"success",title:"\u5931\u6557",text:l.isAxiosError?l.response.data.message:l.message})}e.submitting=!1},b=async()=>{try{const{data:a}=await V.get("/activities/all");i.splice(0,i.length),i.push(...a.result)}catch(a){console.log(a),p.fire({icon:"error",title:"\u5931\u6557",text:a.isAxiosError?a.response.data.message:a.message})}};b();const v=async a=>{console.log(a);try{await V.delete("/activities/"+a),await p.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"}),b()}catch(l){await p.fire({icon:"success",title:"\u5931\u6557",text:l.isAxiosError&&l.response.data?l.response.data.message:"\u767C\u751F\u932F\u8AA4"})}};return(a,l)=>{const c=N("q-card-action");return f(),x("div",ae,[m("div",oe,[m("div",se,[o(u,{label:"\u65B0\u589E\u6D3B\u52D5",color:"secondary",onClick:l[0]||(l[0]=t=>_(""))}),o(F,{modelValue:e.dialog,"onUpdate:modelValue":l[16]||(l[16]=t=>e.dialog=t),persistent:""},{default:s(()=>[o(Q,{style:{width:"700px","max-width":"80vw"}},{default:s(()=>[o(Y,null,{default:s(()=>[o(Z,null,{default:s(()=>[ie]),_:1})]),_:1}),o(W,{modelValue:e.valid,"onUpdate:modelValue":l[15]||(l[15]=t=>e.valid=t),onSubmit:h($,["prevent"])},{default:s(()=>[o(Q,null,{default:s(()=>[o(z,{class:"q-pt-none"},{default:s(()=>[o(n,{dense:"",modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.name=t),autofocus:"",label:"\u6D3B\u52D5\u540D\u7A31",rules:[r.required]},null,8,["modelValue","rules"]),o(n,{dense:"",modelValue:e.CH_name,"onUpdate:modelValue":l[2]||(l[2]=t=>e.CH_name=t),autofocus:"",label:"\u6D3B\u52D5\u540D\u7A31(\u4E2D\u6587)",rules:[r.required]},null,8,["modelValue","rules"]),o(n,{dense:"",modelValue:e.description,"onUpdate:modelValue":l[3]||(l[3]=t=>e.description=t),autofocus:"",type:"textarea",label:"\u6D3B\u52D5\u6558\u8FF0(\u82F1\u6587)",rules:[r.required]},null,8,["modelValue","rules"]),o(n,{dense:"",modelValue:e.CH_description,"onUpdate:modelValue":l[4]||(l[4]=t=>e.CH_description=t),autofocus:"",type:"textarea",label:"\u6D3B\u52D5\u6558\u8FF0\uFF08\u4E2D\u6587\uFF09",rules:[r.required]},null,8,["modelValue","rules"]),o(n,{dense:"",modelValue:e.location,"onUpdate:modelValue":l[5]||(l[5]=t=>e.location=t),autofocus:"",label:"\u6D3B\u52D5\u5730\u9EDE",rules:[r.required]},null,8,["modelValue","rules"]),o(n,{dense:"",modelValue:e.dateStart,"onUpdate:modelValue":l[6]||(l[6]=t=>e.dateStart=t),autofocus:"",label:"\u958B\u59CB\u65E5\u671F",rules:[r.required]},null,8,["modelValue","rules"]),o(n,{dense:"",modelValue:e.dateEnd,"onUpdate:modelValue":l[7]||(l[7]=t=>e.dateEnd=t),autofocus:"",label:"\u7D50\u675F\u65E5\u671F"},null,8,["modelValue"]),o(n,{dense:"",modelValue:e.time,"onUpdate:modelValue":l[8]||(l[8]=t=>e.time=t),autofocus:"",label:"\u6642\u9593"},null,8,["modelValue"]),o(n,{dense:"",modelValue:e.price,"onUpdate:modelValue":l[9]||(l[9]=t=>e.price=t),autofocus:"",label:"\u50F9\u683C"},null,8,["modelValue"]),o(H,{modelValue:e.category,"onUpdate:modelValue":l[10]||(l[10]=t=>e.category=t),options:I,label:"\u884C\u7A0B\u5206\u985E\uFF08\u82F1\u6587\uFF09",rules:[r.required]},null,8,["modelValue","rules"]),o(H,{modelValue:e.CH_category,"onUpdate:modelValue":l[11]||(l[11]=t=>e.CH_category=t),options:T,label:"\u884C\u7A0B\u5206\u985E\uFF08\u4E2D\u6587\uFF09",rules:[r.required]},null,8,["modelValue","rules"]),o(j,{dense:"",modelValue:e.image,"onUpdate:modelValue":l[12]||(l[12]=t=>e.image=t),autofocus:"",label:"\u7167\u7247"},null,8,["modelValue"]),o(L,{modelValue:e.sell,"onUpdate:modelValue":l[13]||(l[13]=t=>e.sell=t),label:"\u4E0A\u67B6",color:"teal"},null,8,["modelValue"])]),_:1}),o(R,{align:"right",class:"text-primary"},{default:s(()=>[k(o(u,{flat:"",type:"submit",loading:e.submitting,label:"\u78BA\u5B9A"},null,8,["loading"]),[[D]]),k(o(u,{flat:"",label:"\u53D6\u6D88",onClick:l[14]||(l[14]=t=>e.dialog=!1),disabled:e.submitting},null,8,["disabled"]),[[D]])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),m("div",ne,[o(te,{grid:a.$q.screen.xs,title:"\u6D3B\u52D5\u7BA1\u7406",rows:i,columns:A,"row-key":"name",filter:C.value,"hide-header":"",onRowClick:a.onRowClick},{"top-right":s(()=>[o(n,{borderless:"",dense:"",debounce:"300",modelValue:C.value,"onUpdate:modelValue":l[17]||(l[17]=t=>C.value=t),placeholder:"Search"},{append:s(()=>[o(G,{name:"search"})]),_:1},8,["modelValue"])]),item:s(t=>[m("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:J(t.selected?"transform: scale(0.95);":"")},[o(Q,{class:K(t.selected?"bg-grey-2":"")},{default:s(()=>[(f(!0),x(M,null,O(t.cols,d=>(f(),w(ee,{key:d.name},{default:s(()=>[o(U,null,{default:s(()=>[o(E,null,{default:s(()=>[o(U,null,{default:s(()=>[d.name!=="image"?(f(),w(S,{key:0,caption:""},{default:s(()=>[g(P(d.value),1)]),_:2},1024)):d.name=="image"?(f(),w(q,{key:1,square:""},{default:s(()=>[m("img",{src:t.row.image,alt:""},null,8,re)]),_:2},1024)):X("",!0)]),_:2},1024)]),_:2},1024),o(E,{side:""},{default:s(()=>[o(S,{caption:""})]),_:1})]),_:2},1024)]),_:2},1024))),128)),o(c,null,{default:s(()=>[o(u,{onClick:d=>_(t.row._id)},{default:s(()=>[de]),_:2},1032,["onClick"]),o(u,{onClick:d=>v(t.row._id)},{default:s(()=>[ue]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["class"])],4)]),"body-cell-edit":s(t=>[o(u,{onClick:d=>_(t.row._id),edit:t},{default:s(()=>[me]),_:2},1032,["onClick","edit"]),o(u,{onClick:d=>v(t.row._id)},{default:s(()=>[ce]),_:2},1032,["onClick"])]),"body-cell-image":s(t=>[o(le,null,{default:s(()=>[o(q,{square:"",size:"100px"},{default:s(()=>[m("img",{src:t.row.image,alt:""},null,8,pe)]),_:2},1024)]),_:2},1024)]),_:1},8,["grid","rows","filter","onRowClick"])])])])}}};export{Ae as default};
