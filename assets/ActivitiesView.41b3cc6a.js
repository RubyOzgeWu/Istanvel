import{A as y,r as F,k as f,l as x,n as m,f as a,Q as u,C as s,b9 as T,bc as V,aU as p,D as N,aR as w,aV as z,a_ as h,aW as n,bt as R,bw as L,J as k,G,p as J,q as K,F as M,b0 as O,B as Q,K as g,a$ as P,E as W}from"./index.5ef8ba6c.js";import{Q as j,a as X}from"./QToolbar.87d9ca0e.js";import{b as H,Q as q}from"./QSelect.2a051dab.js";import{Q as Y}from"./QFile.52d0e78b.js";import{Q as Z}from"./QForm.aa9c5075.js";import{Q as S}from"./QAvatar.90e980d2.js";import{Q as U,a as E}from"./QItem.b1783696.js";import{Q as ee}from"./QList.5ff5e0fa.js";import{Q as le}from"./QTd.a2050118.js";import{Q as te}from"./QTable.71dea2ca.js";import{C as A}from"./ClosePopup.1c28ff9a.js";import"./QMenu.f1fe4bfb.js";import"./selection.7286b50e.js";import"./rtl.4b414a6d.js";import"./QMarkupTable.cd57968b.js";import"./use-fullscreen.ed49a465.js";const ae={class:"q-pa-md"},oe={class:"row"},se={class:"col-12"},ie=m("span",{class:"text-weight-bold"},"\u65B0\u589E\u5546\u54C1",-1),ne={class:"col-12"},re=["src"],de=g("\u7DE8\u8F2F"),ue=g("\u522A\u9664"),me=g("\u7DE8\u8F2F"),ce=g("\u522A\u9664"),pe=["src"],Ae={__name:"ActivitiesView",setup(fe){const D=[{name:"Name",required:!0,label:"\u6D3B\u52D5\u540D\u7A31\uFF08\u82F1\u6587\uFF09",align:"left",field:o=>o.name,format:o=>`${o}`,sortable:!0},{name:"ChName",align:"center",label:"\u6D3B\u52D5\u540D\u7A31\uFF08\u4E2D\u6587\uFF09",field:o=>o.CH_name,sortable:!0},{name:"image",align:"center",label:"\u7167\u7247",sortable:!0},{name:"DateStart",label:"Category",field:o=>o.dateStart,sortable:!0},{name:"DateEnd",label:"Category",field:o=>o.dateEnd,sortable:!0},{name:"edit",label:"\u7DE8\u8F2F\u522A\u9664",sortable:!0}],i=y([]),C=F(""),e=y({_id:"",name:"",CH_name:"",description:"",CH_description:"",image:null,location:"",dateStart:"",dateEnd:"",time:"",price:0,category:"",CH_category:"",sell:!1,idx:-1,dialog:!1,valid:!1,submitting:!1}),$=["Art & Design","Technology & Science","Food","Industry","Business"],I=["\u85DD\u8853\u8A2D\u8A08","\u79D1\u6280\u8207\u79D1\u5B78","\u98DF\u7269","\u7522\u696D","\u5546\u696D"],r=y({required(o){return!!o||"\u5FC5\u586B"},price(o){return o>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(o){var l,c,t;return!o||!o.length||((c=(l=o[0])==null?void 0:l.type)==null?void 0:c.includes("image"))&&((t=o[0])==null?void 0:t.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),_=o=>{e._id=o;const l=o===""?-1:i.findIndex(c=>c._id===o);l>-1?(e.name=i[l].name,e.CH_name=i[l].CH_name,e.description=i[l].description,e.CH_description=i[l].CH_description,e.location=i[l].location,e.dateStart=i[l].dateStart,e.dateEnd=i[l].dateEnd,e.time=i[l].time,e.price=i[l].price,e.category=i[l].category,e.CH_category=i[l].CH_category,e.sell=i[l].sell):(e.name="",e.CH_name="",e.description="",e.CH_description="",e.location="",e.dateStart="",e.dateEnd="",e.time="",e.price=0,e.category="",e.CH_category="",e.sell=!1),e.image=null,e.idx=l,e.dialog=!0,e.valid=!1,e.submitting=!1},B=async()=>{e.submitting=!0;const o=new FormData;for(const l in e)["_id","idx","dialog","valid","submitting"].includes(l)||o.append(l,e[l]);try{if(e._id.length===0){const{data:l}=await V.post("/activities",o);i.splice(0,i.length),i.push(l.result),p.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"}),b()}else{const{data:l}=await V.patch("/activities/"+e._id,o);i[e.idx]=l.result,p.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),b()}e.dialog=!1}catch(l){p.fire({icon:"success",title:"\u5931\u6557",text:l.isAxiosError?l.response.data.message:l.message})}e.submitting=!1},b=async()=>{try{const{data:o}=await V.get("/activities/all");i.splice(0,i.length),i.push(...o.result)}catch(o){console.log(o),p.fire({icon:"error",title:"\u5931\u6557",text:o.isAxiosError?o.response.data.message:o.message})}};b();const v=async o=>{console.log(o);try{await V.delete("/activities/"+o),await p.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"}),b()}catch(l){await p.fire({icon:"success",title:"\u5931\u6557",text:l.isAxiosError&&l.response.data?l.response.data.message:"\u767C\u751F\u932F\u8AA4"})}};return(o,l)=>{const c=N("q-card-action");return f(),x("div",ae,[m("div",oe,[m("div",se,[a(u,{label:"\u65B0\u589E\u6D3B\u52D5",color:"secondary",onClick:l[0]||(l[0]=t=>_(""))}),a(T,{modelValue:e.dialog,"onUpdate:modelValue":l[16]||(l[16]=t=>e.dialog=t),persistent:""},{default:s(()=>[a(w,{style:{width:"700px","max-width":"80vw"}},{default:s(()=>[a(j,null,{default:s(()=>[a(X,null,{default:s(()=>[ie]),_:1})]),_:1}),a(Z,{modelValue:e.valid,"onUpdate:modelValue":l[15]||(l[15]=t=>e.valid=t),onSubmit:z(B,["prevent"])},{default:s(()=>[a(w,null,{default:s(()=>[a(h,{class:"q-pt-none"},{default:s(()=>[a(n,{dense:"",modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=t=>e.name=t),autofocus:"",label:"\u6D3B\u52D5\u540D\u7A31",rules:[r.required]},null,8,["modelValue","rules"]),a(n,{dense:"",modelValue:e.CH_name,"onUpdate:modelValue":l[2]||(l[2]=t=>e.CH_name=t),autofocus:"",label:"\u6D3B\u52D5\u540D\u7A31(\u4E2D\u6587)",rules:[r.required]},null,8,["modelValue","rules"]),a(n,{dense:"",modelValue:e.description,"onUpdate:modelValue":l[3]||(l[3]=t=>e.description=t),autofocus:"",type:"textarea",label:"\u6D3B\u52D5\u6558\u8FF0(\u82F1\u6587)",rules:[r.required]},null,8,["modelValue","rules"]),a(n,{dense:"",modelValue:e.CH_description,"onUpdate:modelValue":l[4]||(l[4]=t=>e.CH_description=t),autofocus:"",type:"textarea",label:"\u6D3B\u52D5\u6558\u8FF0\uFF08\u4E2D\u6587\uFF09",rules:[r.required]},null,8,["modelValue","rules"]),a(n,{dense:"",modelValue:e.location,"onUpdate:modelValue":l[5]||(l[5]=t=>e.location=t),autofocus:"",label:"\u6D3B\u52D5\u5730\u9EDE",rules:[r.required]},null,8,["modelValue","rules"]),a(n,{dense:"",modelValue:e.dateStart,"onUpdate:modelValue":l[6]||(l[6]=t=>e.dateStart=t),autofocus:"",label:"\u958B\u59CB\u65E5\u671F",rules:[r.required]},null,8,["modelValue","rules"]),a(n,{dense:"",modelValue:e.dateEnd,"onUpdate:modelValue":l[7]||(l[7]=t=>e.dateEnd=t),autofocus:"",label:"\u7D50\u675F\u65E5\u671F"},null,8,["modelValue"]),a(n,{dense:"",modelValue:e.time,"onUpdate:modelValue":l[8]||(l[8]=t=>e.time=t),autofocus:"",label:"\u6642\u9593"},null,8,["modelValue"]),a(n,{dense:"",modelValue:e.price,"onUpdate:modelValue":l[9]||(l[9]=t=>e.price=t),autofocus:"",label:"\u50F9\u683C"},null,8,["modelValue"]),a(H,{modelValue:e.category,"onUpdate:modelValue":l[10]||(l[10]=t=>e.category=t),options:$,label:"\u884C\u7A0B\u5206\u985E\uFF08\u82F1\u6587\uFF09",rules:[r.required]},null,8,["modelValue","rules"]),a(H,{modelValue:e.CH_category,"onUpdate:modelValue":l[11]||(l[11]=t=>e.CH_category=t),options:I,label:"\u884C\u7A0B\u5206\u985E\uFF08\u4E2D\u6587\uFF09",rules:[r.required]},null,8,["modelValue","rules"]),a(Y,{dense:"",modelValue:e.image,"onUpdate:modelValue":l[12]||(l[12]=t=>e.image=t),autofocus:"",label:"\u7167\u7247"},null,8,["modelValue"]),a(R,{modelValue:e.sell,"onUpdate:modelValue":l[13]||(l[13]=t=>e.sell=t),label:"\u4E0A\u67B6",color:"teal"},null,8,["modelValue"])]),_:1}),a(L,{align:"right",class:"text-primary"},{default:s(()=>[k(a(u,{flat:"",type:"submit",loading:e.submitting,label:"\u78BA\u5B9A"},null,8,["loading"]),[[A]]),k(a(u,{flat:"",label:"\u53D6\u6D88",onClick:l[14]||(l[14]=t=>e.dialog=!1),disabled:e.submitting},null,8,["disabled"]),[[A]])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),m("div",ne,[a(te,{grid:o.$q.screen.xs,title:"\u6D3B\u52D5\u7BA1\u7406",rows:i,columns:D,"row-key":"name",filter:C.value,"hide-header":"",onRowClick:o.onRowClick},{"top-right":s(()=>[a(n,{borderless:"",dense:"",debounce:"300",modelValue:C.value,"onUpdate:modelValue":l[17]||(l[17]=t=>C.value=t),placeholder:"Search"},{append:s(()=>[a(G,{name:"search"})]),_:1},8,["modelValue"])]),item:s(t=>[m("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:J(t.selected?"transform: scale(0.95);":"")},[a(w,{class:K(t.selected?"bg-grey-2":"")},{default:s(()=>[(f(!0),x(M,null,O(t.cols,d=>(f(),Q(ee,{key:d.name},{default:s(()=>[a(U,null,{default:s(()=>[a(E,null,{default:s(()=>[a(U,null,{default:s(()=>[d.name!=="image"?(f(),Q(q,{key:0,caption:""},{default:s(()=>[g(P(d.value),1)]),_:2},1024)):d.name=="image"?(f(),Q(S,{key:1,square:""},{default:s(()=>[m("img",{src:t.row.image,alt:""},null,8,re)]),_:2},1024)):W("",!0)]),_:2},1024)]),_:2},1024),a(E,{side:""},{default:s(()=>[a(q,{caption:""})]),_:1})]),_:2},1024)]),_:2},1024))),128)),a(c,null,{default:s(()=>[a(u,{onClick:d=>_(t.row._id)},{default:s(()=>[de]),_:2},1032,["onClick"]),a(u,{onClick:d=>v(t.row._id)},{default:s(()=>[ue]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["class"])],4)]),"body-cell-edit":s(t=>[a(u,{onClick:d=>_(t.row._id),edit:t},{default:s(()=>[me]),_:2},1032,["onClick","edit"]),a(u,{onClick:d=>v(t.row._id)},{default:s(()=>[ce]),_:2},1032,["onClick"])]),"body-cell-image":s(t=>[a(le,null,{default:s(()=>[a(S,{square:"",size:"100px"},{default:s(()=>[m("img",{src:t.row.image,alt:""},null,8,pe)]),_:2},1024)]),_:2},1024)]),_:1},8,["grid","rows","filter","onRowClick"])])])])}}};export{Ae as default};
