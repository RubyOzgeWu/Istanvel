import{Q as b}from"./QSelect.1d3b3390.js";import{r as N,A as h,c as Y,l as m,m as k,f as l,C as a,D as Z,Q as u,B as y,E as w,p,aQ as Q,t as j,F as U,aZ as D,K as d,aY as v,q as G,b6 as W,aX as x,aS as ee,aT as V,J as F,H as T}from"./index.2dd91d1a.js";import{Q as z}from"./QAvatar.3187afed.js";import{Q as L,a as M}from"./QItem.af45d9e8.js";import{Q as te}from"./QList.b700af0b.js";import{Q as I}from"./QTd.06ccfbb5.js";import{Q as ae}from"./QTable.fe3697d5.js";import{Q as le,a as oe,b as q}from"./QStepper.4cd7af95.js";import{Q as se}from"./QForm.0ada9d0b.js";import{C as O}from"./ClosePopup.ab3b4512.js";import{u as ie,b as $,S}from"./user.0f3afc9a.js";import{v as ne}from"./index.0517b504.js";import"./QMenu.6fe1a7c2.js";import"./selection.0a2eb727.js";import"./rtl.4b414a6d.js";import"./QMarkupTable.0d439ea0.js";import"./use-fullscreen.655b49f1.js";import"./use-panel.7e71bdde.js";import"./touch.70a9dd44.js";import"./use-cache.b0833c75.js";const re={class:"q-pa-md"},ue=d("-"),de=d("+"),me=d("delete"),ce=["src"],fe=d("-"),pe=d("+"),_e=d("\u522A\u9664"),ge=["src"],ye=d("\u65B0\u589E\u8A02\u8CFC\u8CC7\u6599"),ve=p("div",{class:"text-h6"},"\u65B0\u589E\u8A02\u8CFC\u8CC7\u6599",-1),Ce=d("\u7DE8\u8F2F"),be=d("\u7D50\u5E33"),Oe={__name:"CH_CartView",setup(he){const _=N(1),C=ie(),J=[{name:"name",required:!0,label:"Name",align:"left",field:t=>{var o,i;return((o=t.tour)==null?void 0:o.CH_name)||((i=t.activity)==null?void 0:i.CH_name)},format:t=>`${t}`,sortable:!0},{name:"image",align:"center",label:"\u7167\u7247",sortable:!0},{name:"edit",label:"\u6578\u91CF",field:t=>t.quantity,sortable:!0},{name:"deleteIt",label:"\u522A\u9664",field:t=>t.quantity,sortable:!0}],n=h([]),K=N(""),P=h([t=>!!t||"\u4FE1\u7BB1\u5FC5\u586B",t=>ne.exports.isEmail(t)||"\u8ACB\u8F38\u5165\u6B63\u78BA\u7684\u4FE1\u7BB1\u683C\u5F0F"]),s=h({_id:"",name:"",email:"",phone:"",idx:-1,dialog:!1,submitting:!1}),B=t=>{s._id=t;const o=t===""?-1:c.findIndex(i=>i._id===t);o>-1?(s.name=c[o].name,s.email=c[o].email,s.phone=c[o].phone):(s.name="",s.email="",s.phone=""),s.idx=o,s.dialog=!0,s.submitting=!1},g=async(t,o)=>{const i=n.findIndex(e=>e._id===t);n[i].tour?await C.updateCart({tour:n[i].tour._id,quantity:o})&&(o===0?n.splice(i,1):n[i].quantity=o):n[i].activity&&await C.updateCart({activity:n[i].activity._id,quantity:o})&&(o===0?n.splice(i,1):n[i].quantity=o)};(async()=>{try{const{data:t}=await $.get("/users/cart");n.splice(0,n.length),n.push(...t.result)}catch(t){S.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}})();const c=h([]),E=async()=>{try{const{data:t}=await $.get("/users/orderInfo");c.splice(0,n.length),c.push(...t.result)}catch(t){console.log(t),S.fire({icon:"error",title:"failed",text:t.isAxiosError?t.response.data.message:t.message})}};E();const R=async()=>{s.submitting=!0;try{if(s._id.length===0)C.CH_addOrderInfo({name:s.name,email:s.email,phone:s.phone});else{const{data:t}=await $.patch("/users/orderInfo",{_id:s._id,name:s.name,email:s.email,phone:s.phone})}E()}catch(t){S.fire({icon:"error",title:"\u5931\u6557",text:t.isAxiosError?t.response.data.message:t.message})}s.submitting=!1},A=()=>(console.log(c),c.length!==0),X=Y(()=>n.length>0&&!n.some(t=>{var o,i;return!(((o=t.tour)==null?void 0:o.sell)||((i=t.activity)==null?void 0:i.sell))}));return(t,o)=>{const i=Z("q-card-action");return m(),k("div",re,[l(le,{modelValue:_.value,"onUpdate:modelValue":o[7]||(o[7]=e=>_.value=e),ref:"stepper",color:"primary",animated:""},{navigation:a(()=>[l(oe,null,{default:a(()=>[l(u,{onClick:o[5]||(o[5]=e=>t.$refs.stepper.next()),color:"primary",label:_.value===4?"Finish":"Continue"},null,8,["label"]),_.value>1?(m(),y(u,{key:0,flat:"",color:"primary",onClick:o[6]||(o[6]=e=>t.$refs.stepper.previous()),label:"Back",class:"q-ml-sm"})):w("",!0)]),_:1})]),default:a(()=>[l(q,{name:1,title:"My Cart",icon:"settings",done:_.value>1},{default:a(()=>[l(ae,{grid:t.$q.screen.xs,title:"\u6211\u7684\u8CFC\u7269\u8ECA",rows:n,columns:J,"row-key":"name",filter:K.value,"hide-header":""},{item:a(e=>[p("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:G(e.selected?"transform: scale(0.95);":"")},[l(Q,{class:j(e.selected?"bg-grey-2":"")},{default:a(()=>[(m(!0),k(U,null,D(e.cols,r=>(m(),y(te,{key:r.name},{default:a(()=>[l(L,null,{default:a(()=>[l(M,null,{default:a(()=>[l(L,null,{default:a(()=>[r.name!=="image"&&r.name!=="edit"&&r.name!=="deleteIt"?(m(),y(b,{key:0,caption:""},{default:a(()=>[d(v(r.value),1)]),_:2},1024)):w("",!0),r.name==="edit"?(m(),y(b,{key:1,caption:""},{default:a(()=>[l(i,null,{default:a(()=>[l(u,{onClick:f=>g(e.row._id,e.row.quantity-1),variant:"text"},{default:a(()=>[ue]),_:2},1032,["onClick"]),d(" "+v(r.value)+" ",1),l(u,{onClick:f=>g(e.row._id,e.row.quantity+1),variant:"text"},{default:a(()=>[de]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):w("",!0),r.name==="deleteIt"?(m(),y(b,{key:2,caption:""},{default:a(()=>[l(i,null,{default:a(()=>[l(u,{onClick:f=>g(e.row._id,0)},{default:a(()=>[me]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):r.name=="image"?(m(),y(z,{key:3,square:""},{default:a(()=>{var f,H;return[p("img",{src:((f=e.row.tour)==null?void 0:f.image)||((H=e.row.activity)==null?void 0:H.image),alt:""},null,8,ce)]}),_:2},1024)):w("",!0)]),_:2},1024)]),_:2},1024),l(M,{side:""},{default:a(()=>[l(b,{caption:""})]),_:1})]),_:2},1024)]),_:2},1024))),128))]),_:2},1032,["class"])],4)]),"body-cell-edit":a(e=>[l(I,{edit:e},{default:a(()=>[l(u,{onClick:r=>g(e.row._id,e.row.quantity-1),variant:"text"},{default:a(()=>[fe]),_:2},1032,["onClick"]),d(" "+v(e.row.quantity)+" ",1),l(u,{onClick:r=>g(e.row._id,e.row.quantity+1),variant:"text"},{default:a(()=>[pe]),_:2},1032,["onClick"])]),_:2},1032,["edit"])]),"body-cell-deleteIt":a(e=>[l(I,null,{default:a(()=>[l(u,{onClick:r=>g(e.row._id,0)},{default:a(()=>[_e]),_:2},1032,["onClick"])]),_:2},1024)]),"body-cell-image":a(e=>[l(I,null,{default:a(()=>[l(z,{square:"",size:"100px"},{default:a(()=>{var r,f;return[p("img",{src:((r=e.row.tour)==null?void 0:r.image)||((f=e.row.activity)==null?void 0:f.image),alt:""},null,8,ge)]}),_:2},1024)]),_:2},1024)]),_:1},8,["grid","rows","filter"])]),_:1},8,["done"]),l(q,{name:2,title:"Enter Info",icon:"create_new_folder",done:_.value>2},{default:a(()=>[l(u,{color:"secondary",onClick:o[0]||(o[0]=e=>B("")),disabled:A()},{default:a(()=>[ye]),_:1},8,["disabled"]),l(W,{modelValue:s.dialog,"onUpdate:modelValue":o[4]||(o[4]=e=>s.dialog=e),persistent:""},{default:a(()=>[l(Q,{style:{"min-width":"700px"}},{default:a(()=>[l(x,null,{default:a(()=>[ve]),_:1}),l(x,{class:"q-pt-none"},{default:a(()=>[l(se,{onSubmit:ee(R,["prevent"])},{default:a(()=>[l(V,{filled:"",modelValue:s.name,"onUpdate:modelValue":o[1]||(o[1]=e=>s.name=e),label:"\u8A02\u8CFC\u4EBA\u59D3\u540D",rules:[e=>e&&e.length>0||"\u8ACB\u8F38\u5165\u8A02\u8CFC\u4EBA\u59D3\u540D"]},null,8,["modelValue","rules"]),l(V,{filled:"",modelValue:s.email,"onUpdate:modelValue":o[2]||(o[2]=e=>s.email=e),label:"\u8A02\u8CFC\u4EBA\u4FE1\u7BB1",rules:P},null,8,["modelValue","rules"]),l(V,{filled:"",modelValue:s.phone,"onUpdate:modelValue":o[3]||(o[3]=e=>s.phone=e),label:"\u806F\u7D61\u96FB\u8A71",rules:[e=>e&&e.length>0||"\u8ACB\u8F38\u5165\u8A02\u8CFC\u4EBA\u96FB\u8A71"]},null,8,["modelValue","rules"]),F(l(u,{flat:"",label:"\u53D6\u6D88"},null,512),[[O]]),F(l(u,{flat:"",label:"\u5132\u5B58",type:"submit"},null,512),[[O]])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Q,{class:"my-card"},{default:a(()=>[l(x,null,{default:a(()=>[(m(!0),k(U,null,D(c,e=>(m(),k("div",{key:e._id},[p("p",null,"\u8A02\u8CFC\u4EBA\u59D3\u540D: "+v(e.name),1),p("p",null,"\u8A02\u8CFC\u4EBA\u4FE1\u7BB1: "+v(e.email),1),p("p",null,"\u806F\u7D61\u96FB\u8A71: "+v(e.phone),1),l(u,{onClick:r=>B(e._id),flat:""},{default:a(()=>[Ce]),_:2},1032,["onClick"])]))),128))]),_:1})]),_:1})]),_:1},8,["done"]),l(q,{name:3,title:"Check Out",icon:"assignment"},{default:a(()=>[l(u,{color:"secondary",onClick:T(C).CH_checkout,disabled:!A()||!T(X)},{default:a(()=>[be]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["modelValue"])])}}};export{Oe as default};
